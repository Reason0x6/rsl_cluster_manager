{% extends "clans/base.html" %}

{% block title %}Export to Discord{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">
    <h2 class="text-2xl font-semibold text-white mb-4">Discord Export: {{ siege_plan.name }}</h2>

    <label for="discord-markdown" class="block text-sm text-gray-400 mb-2">Discord Markdown</label>
    <textarea id="discord-markdown" rows="16" class="w-full bg-gray-800 text-white p-4 rounded-lg font-mono" readonly>
{% for assignment in assignments %}
- Post {{ assignment.post_number }}: {{ assignment.get_team_choice_display }} â€” {% if assignment.assigned_player %}{{ assignment.assigned_player.name }}{% else %}Unassigned{% endif %}{% if assignment.selected_arena_team and assignment.selected_arena_team.champions %} ({{ assignment.selected_arena_team.champions|join:", " }}){% endif %}{% endfor %}
</textarea>

    <div class="mt-3 flex items-center gap-3">
        <button id="copy-discord-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Copy</button>
        <a href="{% url 'assign_siege_plan' siege_plan.id %}" class="text-sm text-gray-400 hover:underline">Back to assignments</a>
        <span id="discord-copy-msg" class="text-sm text-green-400 hidden">Copied to clipboard</span>
    </div>
    
    <div class="max-w-4xl mx-auto  mt-6">
        <h3 class="text-xl font-semibold text-white mb-2">Unassigned Defenses</h3>
        <label for="player-counts" class="block text-sm text-gray-400 mb-2">Players | number of posts assigned</label>
        <textarea id="player-counts" rows="18" class="w-full bg-gray-800 text-white p-4 rounded-lg font-mono" readonly>
{% for p in player_stats %}{% if p.count < 2 %}{{ p.name }} | {{ p.count }}
{% endif %}{% endfor %}
        </textarea>

        <div class="mt-3 flex items-center gap-3">
            <button id="copy-players-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Copy players</button>
            <span id="players-copy-msg" class="text-sm text-green-400 hidden">Copied to clipboard</span>
        </div>
    </div>
</div>

<script>
document.getElementById('copy-discord-btn').addEventListener('click', async function () {
    const txt = document.getElementById('discord-markdown').value;
    try {
        await navigator.clipboard.writeText(txt);
        document.getElementById('discord-copy-msg').classList.remove('hidden');
        setTimeout(() => document.getElementById('discord-copy-msg').classList.add('hidden'), 2000);
    } catch (e) {
        alert('Copy failed');
    }
});

document.getElementById('copy-players-btn').addEventListener('click', async function () {
    const txt = document.getElementById('player-counts').value;
    try {
        await navigator.clipboard.writeText(txt);
        document.getElementById('players-copy-msg').classList.remove('hidden');
        setTimeout(() => document.getElementById('players-copy-msg').classList.add('hidden'), 2000);
    } catch (e) {
        alert('Copy failed');
    }
});
</script>

{% endblock %}